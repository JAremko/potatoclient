#!/usr/bin/env bash
# Proto-explorer CLI wrapper with JSON/EDN output format support

# Default to JSON output
OUTPUT_FORMAT="json"

# Check for --edn flag
if [[ "$1" == "--edn" ]]; then
    OUTPUT_FORMAT="edn"
    shift  # Remove the flag from arguments
fi

# Check for --json flag (explicit)
if [[ "$1" == "--json" ]]; then
    OUTPUT_FORMAT="json"
    shift  # Remove the flag from arguments
fi

# Pass the output format to the Clojure code
if [[ "$OUTPUT_FORMAT" == "edn" ]]; then
    bb -e "(binding [proto-explorer.cli/*output-format* :edn] (bb/run-task '$1' (rest *command-line-args*)))" "${@:2}"
else
    # Default JSON output
    bb "$@"
fi